{"ast":null,"code":"import _regeneratorRuntime from\"/home/abhshk/Desktop/Code-Collab-main/code-collab/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/home/abhshk/Desktop/Code-Collab-main/code-collab/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/abhshk/Desktop/Code-Collab-main/code-collab/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useEffect}from\"react\";import{useState}from\"react\";import Button from\"react-bootstrap/Button\";import logo from\"../images/output-onlinepngtools.png\";import Client from\"./Client\";import Editor from\"./Editor\";import{useRef}from\"react\";import{initSocket}from\"../socket.js\";import{useLocation}from\"react-router-dom\";import toast from\"react-hot-toast\";import ACTIONS from\"../Actions\";import{useNavigate,Navigate,useParams}from\"react-router-dom\";import Chat from\"./Chat\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Editorpage=function Editorpage(){var socketRef=useRef(null);var codeRef=useRef(null);var location=useLocation();var _useParams=useParams(),roomId=_useParams.roomId;var reactNavigator=useNavigate();var _useState=useState([]),_useState2=_slicedToArray(_useState,2),clients=_useState2[0],setClients=_useState2[1];function handleErrors(e){console.log(\"socket error\",e);toast.errror(\"Socket Connection failed , try again later.\");reactNavigator(\"/\");}useEffect(function(){var init=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var _location$state;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return initSocket();case 2:socketRef.current=_context.sent;socketRef.current.on(\"connect_error\",function(err){return handleErrors(err);});socketRef.current.on(\"connect_failed\",function(err){return handleErrors(err);});socketRef.current.emit(ACTIONS.JOIN,{roomId:roomId,username:(_location$state=location.state)===null||_location$state===void 0?void 0:_location$state.username});console.log(clients);//For joining\nsocketRef.current.on(ACTIONS.JOINED,function(_ref2){var _location$state2;var clients=_ref2.clients,username=_ref2.username,socketId=_ref2.socketId;if(username!==((_location$state2=location.state)===null||_location$state2===void 0?void 0:_location$state2.username)){toast.success(\"\".concat(username,\" joined the room.\"));console.log(\"\".concat(username,\" joined\"));}setClients(clients);socketRef.current.emit(ACTIONS.SYNC_CODE,{code:codeRef.current,socketId:socketId});});//For disconnection\nsocketRef.current.on(ACTIONS.DISCONNECTED,function(_ref3){var socketId=_ref3.socketId,username=_ref3.username;toast.success(\"\".concat(username,\" left the room.\"));setClients(function(prev){return prev.filter(function(client){return client.socketId!==socketId;});});});case 9:case\"end\":return _context.stop();}}},_callee);}));return function init(){return _ref.apply(this,arguments);};}();init();return function(){socketRef.current.disconnect();socketRef.current.off(ACTIONS.JOINED);socketRef.current.off(ACTIONS.DISCONNECTED);};},[]);if(!location.state){return/*#__PURE__*/_jsx(Navigate,{to:\"/\"});}var copyRoomId=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return navigator.clipboard.writeText(roomId);case 3:toast.success(\"Room Id has been copied to clipboard\");_context2.next=10;break;case 6:_context2.prev=6;_context2.t0=_context2[\"catch\"](0);toast.error(\"Could not copy Room Id\");console.log(_context2.t0);case 10:case\"end\":return _context2.stop();}}},_callee2,null,[[0,6]]);}));return function copyRoomId(){return _ref4.apply(this,arguments);};}();var leaveRoom=function leaveRoom(){reactNavigator(\"/\");};return/*#__PURE__*/_jsxs(\"div\",{className:\"minWrap\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"aside\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"asideInner\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"logo\",children:[/*#__PURE__*/_jsx(\"img\",{className:\"logoImage\",style:{height:\"40px\",width:\"40px\"},src:logo,alt:\"logo\"}),/*#__PURE__*/_jsx(\"h3\",{style:{color:\"rgb(231 11 56 / 78%)\",paddingTop:\"8px\",paddingLeft:\"10px\",fontWeight:\"800\"},children:\"Code Compiler\"})]}),/*#__PURE__*/_jsx(\"h5\",{style:{paddingTop:\"1.5rem\",paddingBottom:\"0.8rem\"},children:\"Connected\"}),/*#__PURE__*/_jsx(\"div\",{className:\"clientsList\",children:clients.map(function(client){return/*#__PURE__*/_jsx(Client,{username:client.username},client.socketId);})})]}),/*#__PURE__*/_jsx(Button,{className:\"btn-copy-btn\",style:{backgroundColor:\"#4d67c3\",border:\"none\",outline:\"none\"},onClick:copyRoomId,children:\"COPY ROOM ID\"}),/*#__PURE__*/_jsx(Button,{className:\"btn-leave-btn\",style:{backgroundColor:\"rgb(231 11 56 / 78%)\",border:\"none\"},onClick:leaveRoom,children:\"LEAVE\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"editorWrap\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"middleTab\",children:/*#__PURE__*/_jsx(Editor,{socketRef:socketRef,roomId:roomId,onCodeChange:function onCodeChange(code){codeRef.current=code;}})}),/*#__PURE__*/_jsx(\"div\",{className:\"rightTab\",children:/*#__PURE__*/_jsx(Chat,{})})]})]});};export default Editorpage;","map":{"version":3,"names":["React","useEffect","useState","Button","logo","Client","Editor","useRef","initSocket","useLocation","toast","ACTIONS","useNavigate","Navigate","useParams","Chat","Editorpage","socketRef","codeRef","location","roomId","reactNavigator","clients","setClients","handleErrors","e","console","log","errror","init","current","on","err","emit","JOIN","username","state","JOINED","socketId","success","SYNC_CODE","code","DISCONNECTED","prev","filter","client","disconnect","off","copyRoomId","navigator","clipboard","writeText","error","leaveRoom","height","width","color","paddingTop","paddingLeft","fontWeight","paddingBottom","map","backgroundColor","border","outline"],"sources":["/home/abhshk/Desktop/Code-Collab-main/code-collab/src/components/Editorpage.js"],"sourcesContent":["import React, { useEffect } from \"react\";\r\nimport { useState } from \"react\";\r\nimport Button from \"react-bootstrap/Button\";\r\nimport logo from \"../images/output-onlinepngtools.png\";\r\nimport Client from \"./Client\";\r\nimport Editor from \"./Editor\";\r\nimport { useRef } from \"react\";\r\nimport { initSocket } from \"../socket.js\";\r\nimport { useLocation } from \"react-router-dom\";\r\nimport toast from \"react-hot-toast\";\r\nimport ACTIONS from \"../Actions\";\r\nimport { useNavigate, Navigate, useParams } from \"react-router-dom\";\r\nimport Chat from \"./Chat\";\r\n\r\nconst Editorpage = () => {\r\n  const socketRef = useRef(null);\r\n  const codeRef = useRef(null);\r\n  const location = useLocation();\r\n\r\n  const { roomId } = useParams();\r\n  const reactNavigator = useNavigate();\r\n  const [clients, setClients] = useState([]);\r\n\r\n  function handleErrors(e) {\r\n    console.log(\"socket error\", e);\r\n    toast.errror(\"Socket Connection failed , try again later.\");\r\n    reactNavigator(\"/\");\r\n  }\r\n\r\n  useEffect(() => {\r\n    const init = async () => {\r\n      //Connection with Socket io\r\n      socketRef.current = await initSocket();\r\n\r\n      socketRef.current.on(\"connect_error\", (err) => handleErrors(err));\r\n      socketRef.current.on(\"connect_failed\", (err) => handleErrors(err));\r\n\r\n      socketRef.current.emit(ACTIONS.JOIN, {\r\n        roomId,\r\n        username: location.state?.username,\r\n      });\r\n      console.log(clients);\r\n\r\n      //For joining\r\n      socketRef.current.on(\r\n        ACTIONS.JOINED,\r\n        ({ clients, username, socketId }) => {\r\n          if (username !== location.state?.username) {\r\n            toast.success(`${username} joined the room.`);\r\n            console.log(`${username} joined`);\r\n          }\r\n          setClients(clients);\r\n          socketRef.current.emit(ACTIONS.SYNC_CODE, {\r\n            code: codeRef.current,\r\n            socketId,\r\n          });\r\n        }\r\n      );\r\n\r\n      //For disconnection\r\n      socketRef.current.on(ACTIONS.DISCONNECTED, ({ socketId, username }) => {\r\n        toast.success(`${username} left the room.`);\r\n        setClients((prev) => {\r\n          return prev.filter((client) => client.socketId !== socketId);\r\n        });\r\n      });\r\n    };\r\n    init();\r\n    return () => {\r\n      socketRef.current.disconnect();\r\n      socketRef.current.off(ACTIONS.JOINED);\r\n      socketRef.current.off(ACTIONS.DISCONNECTED);\r\n    };\r\n  }, []);\r\n\r\n  if (!location.state) {\r\n    return <Navigate to=\"/\" />;\r\n  }\r\n  const copyRoomId = async () => {\r\n    try {\r\n      await navigator.clipboard.writeText(roomId);\r\n      toast.success(\"Room Id has been copied to clipboard\");\r\n    } catch (err) {\r\n      toast.error(\"Could not copy Room Id\");\r\n      console.log(err);\r\n    }\r\n  };\r\n  const leaveRoom = () => {\r\n    reactNavigator(\"/\");\r\n  };\r\n  return (\r\n    <div className=\"minWrap\">\r\n      <div className=\"aside\">\r\n        <div className=\"asideInner\">\r\n          <div className=\"logo\">\r\n            <img\r\n              className=\"logoImage\"\r\n              style={{ height: \"40px\", width: \"40px\" }}\r\n              src={logo}\r\n              alt=\"logo\"\r\n            />\r\n            <h3\r\n              style={{\r\n                color: \"rgb(231 11 56 / 78%)\",\r\n                paddingTop: \"8px\",\r\n                paddingLeft: \"10px\",\r\n                fontWeight: \"800\",\r\n              }}\r\n            >\r\n              Code Compiler\r\n            </h3>\r\n          </div>\r\n          <h5 style={{ paddingTop: \"1.5rem\", paddingBottom: \"0.8rem\" }}>\r\n            Connected\r\n          </h5>\r\n          <div className=\"clientsList\">\r\n            {clients.map((client) => (\r\n              <Client key={client.socketId} username={client.username} />\r\n            ))}\r\n          </div>\r\n        </div>\r\n        <Button\r\n          className=\"btn-copy-btn\"\r\n          style={{\r\n            backgroundColor: \"#4d67c3\",\r\n            border: \"none\",\r\n            outline: \"none\",\r\n          }}\r\n          onClick={copyRoomId}\r\n        >\r\n          COPY ROOM ID\r\n        </Button>\r\n        <Button\r\n          className=\"btn-leave-btn\"\r\n          style={{ backgroundColor: \"rgb(231 11 56 / 78%)\", border: \"none\" }}\r\n          onClick={leaveRoom}\r\n        >\r\n          LEAVE\r\n        </Button>\r\n      </div>\r\n      <div className=\"editorWrap\">\r\n        <div className=\"middleTab\">\r\n          <Editor\r\n            socketRef={socketRef}\r\n            roomId={roomId}\r\n            onCodeChange={(code) => {\r\n              codeRef.current = code;\r\n            }}\r\n          />\r\n        </div>\r\n\r\n        <div className=\"rightTab\">\r\n          <Chat />\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Editorpage;\r\n"],"mappings":"qaAAA,MAAOA,MAAP,EAAgBC,SAAhB,KAAiC,OAAjC,CACA,OAASC,QAAT,KAAyB,OAAzB,CACA,MAAOC,OAAP,KAAmB,wBAAnB,CACA,MAAOC,KAAP,KAAiB,qCAAjB,CACA,MAAOC,OAAP,KAAmB,UAAnB,CACA,MAAOC,OAAP,KAAmB,UAAnB,CACA,OAASC,MAAT,KAAuB,OAAvB,CACA,OAASC,UAAT,KAA2B,cAA3B,CACA,OAASC,WAAT,KAA4B,kBAA5B,CACA,MAAOC,MAAP,KAAkB,iBAAlB,CACA,MAAOC,QAAP,KAAoB,YAApB,CACA,OAASC,WAAT,CAAsBC,QAAtB,CAAgCC,SAAhC,KAAiD,kBAAjD,CACA,MAAOC,KAAP,KAAiB,QAAjB,C,wFAEA,GAAMC,WAAU,CAAG,QAAbA,WAAa,EAAM,CACvB,GAAMC,UAAS,CAAGV,MAAM,CAAC,IAAD,CAAxB,CACA,GAAMW,QAAO,CAAGX,MAAM,CAAC,IAAD,CAAtB,CACA,GAAMY,SAAQ,CAAGV,WAAW,EAA5B,CAEA,eAAmBK,SAAS,EAA5B,CAAQM,MAAR,YAAQA,MAAR,CACA,GAAMC,eAAc,CAAGT,WAAW,EAAlC,CACA,cAA8BV,QAAQ,CAAC,EAAD,CAAtC,wCAAOoB,OAAP,eAAgBC,UAAhB,eAEA,QAASC,aAAT,CAAsBC,CAAtB,CAAyB,CACvBC,OAAO,CAACC,GAAR,CAAY,cAAZ,CAA4BF,CAA5B,EACAf,KAAK,CAACkB,MAAN,CAAa,6CAAb,EACAP,cAAc,CAAC,GAAD,CAAd,CACD,CAEDpB,SAAS,CAAC,UAAM,CACd,GAAM4B,KAAI,4FAAG,+KAEerB,WAAU,EAFzB,QAEXS,SAAS,CAACa,OAFC,eAIXb,SAAS,CAACa,OAAV,CAAkBC,EAAlB,CAAqB,eAArB,CAAsC,SAACC,GAAD,QAASR,aAAY,CAACQ,GAAD,CAArB,EAAtC,EACAf,SAAS,CAACa,OAAV,CAAkBC,EAAlB,CAAqB,gBAArB,CAAuC,SAACC,GAAD,QAASR,aAAY,CAACQ,GAAD,CAArB,EAAvC,EAEAf,SAAS,CAACa,OAAV,CAAkBG,IAAlB,CAAuBtB,OAAO,CAACuB,IAA/B,CAAqC,CACnCd,MAAM,CAANA,MADmC,CAEnCe,QAAQ,kBAAEhB,QAAQ,CAACiB,KAAX,0CAAE,gBAAgBD,QAFS,CAArC,EAIAT,OAAO,CAACC,GAAR,CAAYL,OAAZ,EAEA;AACAL,SAAS,CAACa,OAAV,CAAkBC,EAAlB,CACEpB,OAAO,CAAC0B,MADV,CAEE,eAAqC,yBAAlCf,QAAkC,OAAlCA,OAAkC,CAAzBa,QAAyB,OAAzBA,QAAyB,CAAfG,QAAe,OAAfA,QAAe,CACnC,GAAIH,QAAQ,sBAAKhB,QAAQ,CAACiB,KAAd,2CAAK,iBAAgBD,QAArB,CAAZ,CAA2C,CACzCzB,KAAK,CAAC6B,OAAN,WAAiBJ,QAAjB,uBACAT,OAAO,CAACC,GAAR,WAAeQ,QAAf,aACD,CACDZ,UAAU,CAACD,OAAD,CAAV,CACAL,SAAS,CAACa,OAAV,CAAkBG,IAAlB,CAAuBtB,OAAO,CAAC6B,SAA/B,CAA0C,CACxCC,IAAI,CAAEvB,OAAO,CAACY,OAD0B,CAExCQ,QAAQ,CAARA,QAFwC,CAA1C,EAID,CAZH,EAeA;AACArB,SAAS,CAACa,OAAV,CAAkBC,EAAlB,CAAqBpB,OAAO,CAAC+B,YAA7B,CAA2C,eAA4B,IAAzBJ,SAAyB,OAAzBA,QAAyB,CAAfH,QAAe,OAAfA,QAAe,CACrEzB,KAAK,CAAC6B,OAAN,WAAiBJ,QAAjB,qBACAZ,UAAU,CAAC,SAACoB,IAAD,CAAU,CACnB,MAAOA,KAAI,CAACC,MAAL,CAAY,SAACC,MAAD,QAAYA,OAAM,CAACP,QAAP,GAAoBA,QAAhC,EAAZ,CAAP,CACD,CAFS,CAAV,CAGD,CALD,EA9BW,sDAAH,kBAAJT,KAAI,0CAAV,CAqCAA,IAAI,GACJ,MAAO,WAAM,CACXZ,SAAS,CAACa,OAAV,CAAkBgB,UAAlB,GACA7B,SAAS,CAACa,OAAV,CAAkBiB,GAAlB,CAAsBpC,OAAO,CAAC0B,MAA9B,EACApB,SAAS,CAACa,OAAV,CAAkBiB,GAAlB,CAAsBpC,OAAO,CAAC+B,YAA9B,EACD,CAJD,CAKD,CA5CQ,CA4CN,EA5CM,CAAT,CA8CA,GAAI,CAACvB,QAAQ,CAACiB,KAAd,CAAqB,CACnB,mBAAO,KAAC,QAAD,EAAU,EAAE,CAAC,GAAb,EAAP,CACD,CACD,GAAMY,WAAU,6FAAG,kLAETC,UAAS,CAACC,SAAV,CAAoBC,SAApB,CAA8B/B,MAA9B,CAFS,QAGfV,KAAK,CAAC6B,OAAN,CAAc,sCAAd,EAHe,mFAKf7B,KAAK,CAAC0C,KAAN,CAAY,wBAAZ,EACA1B,OAAO,CAACC,GAAR,eANe,sEAAH,kBAAVqB,WAAU,2CAAhB,CASA,GAAMK,UAAS,CAAG,QAAZA,UAAY,EAAM,CACtBhC,cAAc,CAAC,GAAD,CAAd,CACD,CAFD,CAGA,mBACE,aAAK,SAAS,CAAC,SAAf,wBACE,aAAK,SAAS,CAAC,OAAf,wBACE,aAAK,SAAS,CAAC,YAAf,wBACE,aAAK,SAAS,CAAC,MAAf,wBACE,YACE,SAAS,CAAC,WADZ,CAEE,KAAK,CAAE,CAAEiC,MAAM,CAAE,MAAV,CAAkBC,KAAK,CAAE,MAAzB,CAFT,CAGE,GAAG,CAAEnD,IAHP,CAIE,GAAG,CAAC,MAJN,EADF,cAOE,WACE,KAAK,CAAE,CACLoD,KAAK,CAAE,sBADF,CAELC,UAAU,CAAE,KAFP,CAGLC,WAAW,CAAE,MAHR,CAILC,UAAU,CAAE,KAJP,CADT,2BAPF,GADF,cAmBE,WAAI,KAAK,CAAE,CAAEF,UAAU,CAAE,QAAd,CAAwBG,aAAa,CAAE,QAAvC,CAAX,uBAnBF,cAsBE,YAAK,SAAS,CAAC,aAAf,UACGtC,OAAO,CAACuC,GAAR,CAAY,SAAChB,MAAD,qBACX,KAAC,MAAD,EAA8B,QAAQ,CAAEA,MAAM,CAACV,QAA/C,EAAaU,MAAM,CAACP,QAApB,CADW,EAAZ,CADH,EAtBF,GADF,cA6BE,KAAC,MAAD,EACE,SAAS,CAAC,cADZ,CAEE,KAAK,CAAE,CACLwB,eAAe,CAAE,SADZ,CAELC,MAAM,CAAE,MAFH,CAGLC,OAAO,CAAE,MAHJ,CAFT,CAOE,OAAO,CAAEhB,UAPX,0BA7BF,cAwCE,KAAC,MAAD,EACE,SAAS,CAAC,eADZ,CAEE,KAAK,CAAE,CAAEc,eAAe,CAAE,sBAAnB,CAA2CC,MAAM,CAAE,MAAnD,CAFT,CAGE,OAAO,CAAEV,SAHX,mBAxCF,GADF,cAiDE,aAAK,SAAS,CAAC,YAAf,wBACE,YAAK,SAAS,CAAC,WAAf,uBACE,KAAC,MAAD,EACE,SAAS,CAAEpC,SADb,CAEE,MAAM,CAAEG,MAFV,CAGE,YAAY,CAAE,sBAACqB,IAAD,CAAU,CACtBvB,OAAO,CAACY,OAAR,CAAkBW,IAAlB,CACD,CALH,EADF,EADF,cAWE,YAAK,SAAS,CAAC,UAAf,uBACE,KAAC,IAAD,IADF,EAXF,GAjDF,GADF,CAmED,CA/ID,CAiJA,cAAezB,WAAf"},"metadata":{},"sourceType":"module"}